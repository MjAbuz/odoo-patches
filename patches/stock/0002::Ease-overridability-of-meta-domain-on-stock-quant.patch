===============================================================================

Ease overridability of meta domain on stock_quant.

===============================================================================

 addons/stock/models/stock_quant.py | 41 +++++++++++++++++++++++++-------------
 1 file changed, 27 insertions(+), 14 deletions(-)

diff --git a/addons/stock/models/stock_quant.py b/addons/stock/models/stock_quant.py
index 9c3996e0900..18dba365c13 100644
--- a/addons/stock/models/stock_quant.py
+++ b/addons/stock/models/stock_quant.py
@@ -412,7 +412,6 @@ class Quant(models.Model):
             return reservations
             # return self._Reservation(reserved_quants, qty, qty, move, None)
 
-        restrict_lot_id = lot_id if pack_operation else move.restrict_lot_id.id or lot_id
         removal_strategy = move.get_removal_strategy()
 
         domain = self._quants_get_reservation_domain(
@@ -422,19 +421,12 @@ class Quant(models.Model):
             company_id=company_id,
             initial_domain=domain)
 
-        if not restrict_lot_id and not preferred_domain_list:
-            meta_domains = [[]]
-        elif restrict_lot_id and not preferred_domain_list:
-            meta_domains = [[('lot_id', '=', restrict_lot_id)], [('lot_id', '=', False)]]
-        elif restrict_lot_id and preferred_domain_list:
-            lot_list = []
-            no_lot_list = []
-            for inner_domain in preferred_domain_list:
-                lot_list.append(inner_domain + [('lot_id', '=', restrict_lot_id)])
-                no_lot_list.append(inner_domain + [('lot_id', '=', False)])
-            meta_domains = lot_list + no_lot_list
-        else:
-            meta_domains = preferred_domain_list
+        restrict_lot_id = lot_id if pack_operation else move.restrict_lot_id.id or lot_id
+        meta_domains = self._quants_get_meta_domain(
+            move,
+            restrict_lot_id,
+            preferred_domain_list
+            )
 
         res_qty = qty
         while (float_compare(res_qty, 0, precision_rounding=move.product_id.uom_id.rounding) and meta_domains):
@@ -452,7 +444,28 @@ class Quant(models.Model):
 
         return reservations
 
+    def _quants_get_meta_domain(self, move, restrict_lot_id=False, preferred_domain_list=False):
+        ''' Overridable method providing meta search domains for the quant search iterations.
+            Use `move` object to pass your values.
+        '''
+        if not restrict_lot_id and not preferred_domain_list:
+            meta_domains = [[]]
+        elif restrict_lot_id and not preferred_domain_list:
+            meta_domains = [[('lot_id', '=', restrict_lot_id)], [('lot_id', '=', False)]]
+        elif restrict_lot_id and preferred_domain_list:
+            lot_list = []
+            no_lot_list = []
+            for inner_domain in preferred_domain_list:
+                lot_list.append(inner_domain + [('lot_id', '=', restrict_lot_id)])
+                no_lot_list.append(inner_domain + [('lot_id', '=', False)])
+            meta_domains = lot_list + no_lot_list
+        else:
+            meta_domains = preferred_domain_list
+        return meta_domains
+
+
     def _quants_get_reservation_domain(self, move, pack_operation_id=False, lot_id=False, company_id=False, initial_domain=None):
+        ''' Method providing meta search domains for the quant search iterations '''
         initial_domain = initial_domain if initial_domain is not None else [('qty', '>', 0.0)]
         domain = initial_domain + [('product_id', '=', move.product_id.id)]
 
